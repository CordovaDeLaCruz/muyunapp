<ng-container  *ngIf="!showSpinner">
  <h2>{{userId ? 'Actualizar ' : 'Agregar '}} Usuario</h2>
  <form
    [formGroup]="form"
    fxLayout="column"
    (ngSubmit)="submit()"
    fxLayoutAlign="center"
  >
    <div fxLayout="column">
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Perfil</p>
        <mat-form-field fxFlex="90%" appearance="outline">
          <mat-label>Perfil a asignar</mat-label>
          <mat-select formControlName="role">
            <mat-option *ngFor="let role of profileList" [value]="role.value">
              {{ role.name }}
            </mat-option>
          </mat-select>
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('role')"
              labelName="Rol del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- <div
      fxLayout="column"
      *ngIf="form.get('role')!.value == profileValueList.Passenger"
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Código</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese un Código</mat-label>
          <input type="text" autocomplete="off" formControlName="code" matInput />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('code')"
              labelName="Código del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div> -->

    <div fxLayout="column">
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Nombres</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese sus Nombres</mat-label>
          <input
            type="text"
            autocomplete="off"
            formControlName="firstName"
            matInput
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('firstName')"
              labelName="Nombre del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div fxLayout="column">
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Apellidos</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese sus Apellidos</mat-label>
          <input
            type="text"
            autocomplete="off"
            formControlName="lastName"
            matInput
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('lastName')"
              labelName="Apellido del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="
        form.get('role')!.value == profileValueList.Admin ||
        form.get('role')!.value == profileValueList.Guide
      "
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Tipo de Documento</p>
        <mat-form-field fxFlex="90%" appearance="outline">
          <mat-label>Seleccione el tipo de documento</mat-label>
          <mat-select formControlName="documentType">
            <mat-option
              *ngFor="let documentType of documentTypeList"
              [value]="documentType.value"
            >
              {{ documentType.name }}
            </mat-option>
          </mat-select>
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('documentType')"
              labelName="Tipo de documento del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="
        form.get('role')!.value == profileValueList.Admin ||
        form.get('role')!.value == profileValueList.Guide
      "
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Número de Documento</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese un Número de Documento</mat-label>
          <input
            type="text"
            autocomplete="off"
            formControlName="documentNumber"
            matInput
            maxlength="12"
            minlength="8"
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('documentNumber')"
              labelName="Número de documento del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="
        form.get('role')!.value == profileValueList.Admin ||
        (form.get('role')!.value == profileValueList.Passenger && userId)
      "
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Correo</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese su Correo</mat-label>
          <input
            type="text"
            autocomplete="off"
            formControlName="email"
            matInput
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('email')"
              labelName="Correo del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="
        form.get('role')!.value == profileValueList.Admin ||
        (form.get('role')!.value == profileValueList.Passenger && userId)
      "
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Usuario</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese un Usuario</mat-label>
          <input
            type="text"
            autocomplete="off"
            formControlName="username"
            matInput
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('username')"
              labelName="Usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="
        form.get('role')!.value == profileValueList.Admin ||
        (form.get('role')!.value == profileValueList.Passenger && userId)
      "
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Contraseña</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese una Contraseña</mat-label>
          <input
            type="password"
            formControlName="password"
            autocomplete="off"
            matInput
          />
          <mat-hint *ngIf="userId" >Dejar vacio si no se desea cambiar la contraseña</mat-hint>
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('password')"
              labelName="Contraseña del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="form.get('role')!.value == profileValueList.Guide"
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Experiencia</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Indique su Experiencia</mat-label>

          <input
            type="text"
            autocomplete="off"
            formControlName="experience"
            matInput
          />
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('experience')"
              labelName="Experiencia del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="form.get('role')!.value == profileValueList.Guide"
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <p fxFlex="10%">Descripción</p>
        <mat-form-field fxFlex="90%" appearance="outline" class="full-width">
          <mat-label>Ingrese una breve Descripción</mat-label>

          <textarea
            type="text"
            autocomplete="off"
            formControlName="description"
            matInput
          ></textarea>
          <mat-error>
            <app-validators-messages
              [controlVar]="form.get('description')"
              labelName="Descripción del usuario"
            ></app-validators-messages>
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div
      fxLayout="column"
      *ngIf="form.get('role')!.value == profileValueList.Guide"
    >
      <div
        fxLayout="row"
        fxLayout.xs="column"
        fxFlex="100%"
        fxLayoutAlign="start center"
      >
        <input
          type="file"
          accept="image/png, image/jpg, image/jpeg"
          (change)="onFileSelected($event)"
          class="file-input"
          #fileUpload
        />
        <mat-checkbox
          class="example-margin"
          fxFlex="10%"
          [formControl]="checkPhotoFormControl"
          (click)="removeImage()"
          >Foto</mat-checkbox
        >
        <button
          fxFlex="90%"
          type="button"
          (click)="fileUpload.click()"
          [disabled]="!checkPhotoFormControl.value"
          mat-raised-button
          color="accent"
          *ngIf="!imageUrl"
        >
          Ingresar Foto
        </button>
        <div fxFlex="90%" class="container-img" *ngIf="imageUrl">
          <img style="width: 250px;" [src]="imageUrl" [alt]="imageUrl" />
          <mat-icon (click)="removeImage()" style="cursor: pointer;margin-left: 20px;">close</mat-icon>
        </div>
      </div>

      <!-- <div fxFlex="100%" fxLayout="column" *ngIf="imageUrl">
        <div
          fxLayout="row"
          fxLayout.xs="column"
          fxFlex="100%"
          fxLayoutAlign="start center"
        >
          <p fxFlex="10%"></p>
          <img class="mt-3" fxFlex="90%" [src]="imageUrl" alt="" />
        </div>
      </div> -->
    </div>
  </form>

  <div fxLayout="column" class="mt-5">
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="100px">
      <div fxFlex="50" fxLayoutAlign="end">
        <button
          [disabled]="isLoading"
          routerLink="/user"
          class="action__button"
          mat-raised-button
          color="link"
        >
          Cancelar
        </button>
      </div>
      <div fxFlex="50" fxLayoutAlign="start">
        <button
          [disabled]="form.invalid || isLoading"
          (click)="submit()"
          class="btn_style action__button d-flex justify-content-center"
          mat-raised-button
          color="primary"
        >
          <span *ngIf="!isLoading"> {{userId ? 'Actualizar ' : 'Agregar '}} Usuario</span>
          <div class="root__container__spinner" *ngIf="isLoading">
            <mat-spinner
              *ngIf="isLoading"
              [diameter]="25"
              class="mat-spinner-color-components-send mx-auto"
            ></mat-spinner>
          </div>
        </button>
      </div>
    </div>
  </div>
</ng-container>

<div class="root__container__spinner" *ngIf="showSpinner && userId">
  <div class="contarier__spinner d-flex justify-content-center">
    <div style="display: block;">
    <mat-spinner [diameter]="100" class="mat-spinner-color-components" style="margin: auto;"></mat-spinner>
    <h2 class="text__spinner">Cargando Datos ...</h2>
    </div>
  </div>
</div>
